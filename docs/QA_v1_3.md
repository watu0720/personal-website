# QA v1.3（コメント返信/ソート/運用強化/検索UX）

## コメント返信（1階層）

- [ ] 親コメントに「返信」ボタンが表示されること（Good/Not Good/返信/通報の順）
- [ ] 「返信」ボタンをクリックすると返信入力欄が開くこと
- [ ] 返信入力欄に「キャンセル」と「返信」ボタンが表示されること（左寄せ）
- [ ] 「キャンセル」ボタンで返信入力欄が閉じ、入力内容がクリアされること
- [ ] 返信はログインユーザーのみ投稿可能であること（ゲストは不可）
- [ ] 返信投稿後、返信入力欄が閉じ、返信一覧が自動的に開くこと
- [ ] 親コメントの下に「○件の返信」ボタンが表示されること（返信がある場合）
- [ ] 「○件の返信」ボタンで返信一覧が開閉できること
- [ ] 返信はインデント（`pl-6`）で表示されること
- [ ] 返信は古い順（上→下）で表示されること
- [ ] 返信にもGood/Not Goodボタンが表示され、リアクションできること
- [ ] 返信にも管理者ハートを付けられること（管理者のみ）
- [ ] 返信は通常画面の「最新20件」やコメントログの「100件/ページ」カウントに含まれないこと
- [ ] 画面リロード後も各親コメントの返信件数が表示されること

## コメントソート

- [ ] 通常画面に「新しい順」「古い順」「人気順（Good数）」のソート切り替えボタンが表示されること
- [ ] コメントログ画面にも同様のソート切り替えボタンが表示されること
- [ ] 通常画面：表示中20件の範囲でソートが切り替わること
- [ ] コメントログ：全体条件でソートされた結果がページネーションされること
- [ ] 人気順はGood数が多い順でソートされること（同数の場合は新しい順）

## コメント利用ガイド

- [ ] コメント欄に「コメント利用ガイド」の折りたたみセクションが表示されること
- [ ] ガイドには以下の内容が記載されていること：
  - ゲスト名：2〜20文字
  - リンク：http/httpsのみ、1コメントあたり最大2件まで
  - 誹謗中傷・スパムは禁止
  - 通報内容は管理者のみが確認
  - 編集：本人のみが編集可能

## リンクスパム対策

- [ ] 1コメントあたりリンク数が最大2件までに制限されること
- [ ] リンク数が3件以上の場合、エラーメッセージが表示されること
- [ ] 短縮URL（bit.ly / tinyurl / t.co等）をクリックすると警告モーダルが表示されること
- [ ] punycode（`xn--`）を含むURLをクリックすると警告モーダルが表示されること
- [ ] URLが極端に長い（120文字超）場合、警告モーダルが表示されること
- [ ] 警告モーダルで「移動する」ボタンをクリックすると新規タブで開くこと
- [ ] 通常のリンク（上記以外）はモーダル無しで直接開くこと

## 検索UX改善

- [ ] ヘッダーの検索欄で検索実行時に、検索ワードがlocalStorageに保存されること
- [ ] 検索欄にフォーカスすると、最近検索したワード（最大10件）が候補表示されること
- [ ] 候補をクリックするとそのまま検索されること
- [ ] `/search` 画面に検索対象のフィルタ（チェックボックス）が表示されること
- [ ] フィルタには「ページ」「コメント」「YouTube」「ニコニコ」「GitHub」が含まれること
- [ ] 初期状態では全フィルタが選択されていること
- [ ] フィルタを変更するとURLの `types` パラメータに反映されること
- [ ] フィルタに応じて検索結果が絞り込まれること

## 管理者運用強化

- [ ] 未処理ダッシュボードに未確認通報の件数が表示されること
- [ ] 未処理ダッシュボードに自動非表示中コメントの件数が表示されること
- [ ] 未処理ダッシュボードにストレージ警告（使用率80%以上）が表示されること
- [ ] 未処理ダッシュボードに外部APIキャッシュ状態が表示されること
- [ ] 操作ログ画面にキーワード検索欄が追加されていること
- [ ] 操作ログでキーワード検索が機能すること（action/target_type/target_id/metaを検索）
- [ ] APIキー管理画面で各APIキーの設定状況が表示されること
- [ ] APIキー管理画面で「設定済み」「未設定」のステータスが表示されること

## 外部APIキャッシュ

- [ ] `external_cache` テーブルが作成されていること
- [ ] キャッシュの取得・保存機能が実装されていること（最低限の実装）

## エラーハンドリング統一

- [ ] `ErrorState` コンポーネントが作成されていること
- [ ] `EmptyState` コンポーネントが作成されていること
- [ ] 外部API取得失敗時もページ全体が落ちないこと（最低限の実装）
